---
interface Props {
  title?: string;
  subtitle?: string;
  description?: string;
  topper?: string;
  className?: string;
  id?: string;
}

const { 
  title = "Get in Touch", 
  subtitle,
  description = "Ready to start your project? Contact us today for a free consultation and estimate.",
  topper = "Contact",
  className = "",
  id = "contact"
} = Astro.props;
---

<section class={`cs-contact-form ${className}`} id={id} aria-labelledby={`${id}-heading`}>
  <div class="cs-container">
    <form id="cs-form" name="Contact Form" method="post" novalidate role="form" aria-labelledby={`${id}-heading`}>
      <div class="cs-content">
        {topper && <span class="cs-topper">{topper}</span>}
        <h2 class="cs-title" id={`${id}-heading`}>{title}</h2>
        {subtitle && <h3 class="cs-subtitle">{subtitle}</h3>}
        {description && <p class="cs-text">{description}</p>}
      </div>
      
      <fieldset>
        <legend class="sr-only">Contact Information</legend>
        <div class="cs-form-group">
          <label for={`${id}-name`}>
            <span class="cs-label-text">Name <span class="cs-required">*</span></span>
            <input
              required
              type="text"
              id={`${id}-name`}
              name="name"
              placeholder="Enter your name"
              aria-describedby={`${id}-name-error`}
              aria-required="true"
              autocomplete="name"
            />
            <span class="cs-error" id={`${id}-name-error`} role="alert" aria-live="polite"></span>
          </label>
          
          <label for={`${id}-email`}>
            <span class="cs-label-text">Email <span class="cs-required">*</span></span>
            <input
              required
              type="email"
              id={`${id}-email`}
              name="email"
              placeholder="Enter your email"
              aria-describedby={`${id}-email-error`}
              aria-required="true"
              autocomplete="email"
            />
            <span class="cs-error" id={`${id}-email-error`} role="alert" aria-live="polite"></span>
          </label>
        </div>
        
        <label for={`${id}-phone`}>
          <span class="cs-label-text">Phone <span class="cs-required">*</span></span>
          <input
            required
            type="tel"
            id={`${id}-phone`}
            name="phone"
            placeholder="Enter your phone number"
            aria-describedby={`${id}-phone-error`}
            aria-required="true"
            autocomplete="tel"
          />
          <span class="cs-error" id={`${id}-phone-error`} role="alert" aria-live="polite"></span>
        </label>
      </fieldset>
      
      <fieldset>
        <legend class="sr-only">Project Details</legend>
        <label class="cs-label-message" for={`${id}-message`}>
          <span class="cs-label-text">Message <span class="cs-required">*</span></span>
          <textarea
            required
            name="message"
            id={`${id}-message`}
            placeholder="Tell us about your project..."
            rows="5"
            aria-describedby={`${id}-message-error ${id}-message-help`}
            aria-required="true"
          ></textarea>
          <span class="cs-help-text" id={`${id}-message-help`}>Please provide details about your project needs</span>
          <span class="cs-error" id={`${id}-message-error`} role="alert" aria-live="polite"></span>
        </label>
      </fieldset>
      
      <button class="cs-button-solid" type="submit" aria-describedby={`${id}-submit-status`}>
        <span>Submit</span>
        <svg class="cs-loading" aria-hidden="true" viewBox="0 0 24 24">
          <circle cx="12" cy="12" r="10" stroke="currentColor" stroke-width="2" fill="none" stroke-dasharray="32" stroke-dashoffset="32">
            <animate attributeName="stroke-dasharray" dur="2s" values="0 32;16 16;0 32;0 32" repeatCount="indefinite"/>
            <animate attributeName="stroke-dashoffset" dur="2s" values="0;-16;-32;-32" repeatCount="indefinite"/>
          </circle>
        </svg>
      </button>
      
      <div class="cs-status" id={`${id}-submit-status`} role="status" aria-live="polite" aria-atomic="true"></div>
    </form>
  </div>
</section>

<style lang="less">
@import "@styles/variables.less";
@import "@styles/mixins.less";

.cs-contact-form {
  .section-padding();
  background-color: @form-bg-light;
  .smooth-transition(background-color);
  position: relative;
  
  // Enhanced visual hierarchy with subtle accent
  &::before {
    content: "";
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    height: 4px;
    background: linear-gradient(90deg, var(--primary) 0%, var(--primaryLight) 100%);
    z-index: 1;
  }
  
  // Dark mode background
  body.dark-mode & {
    background-color: var(--medium);
  }
  
  .cs-container {
    .container();
    max-width: 50rem; // 800px
  }

  .cs-content {
    text-align: center;
    margin-bottom: @spacing-lg;
    
    // Mobile: reduce spacing to make content more compact
    @media only screen and (max-width: @tablet - 1px) {
      margin-bottom: @spacing-lg;
    }
    
    @media only screen and (min-width: @tablet) {
      text-align: left;
    }
  }

  .cs-topper {
    .cs-topper-style();
    margin-bottom: @spacing-md;
    display: block;
    position: relative;
    
    // Mobile: smaller margin for compact layout
    @media only screen and (max-width: @tablet - 1px) {
      margin-bottom: @spacing-sm;
    }
    
    // Enhanced visual differentiation consistent with AboutSection
    &::after {
      content: "";
      display: block;
      width: 3rem;
      height: 2px;
      background-color: var(--primary);
      margin: @spacing-sm auto 0;
      transition: width @transition-normal;
      
      @media only screen and (min-width: @tablet) {
        margin: @spacing-sm 0 0;
      }
    }
    
    &:hover::after {
      width: 4rem;
    }
  }

  .cs-title {
    .cs-title-style();
    margin-bottom: @spacing-lg;
    
    // Mobile: smaller margin for compact layout
    @media only screen and (max-width: @tablet - 1px) {
      margin-bottom: @spacing-md;
    }
  }

  .cs-subtitle {
    .cs-subtitle-style();
    margin-bottom: @spacing-md;
    
    // Mobile: smaller margin for compact layout
    @media only screen and (max-width: @tablet - 1px) {
      margin-bottom: @spacing-sm;
    }
  }

  .cs-text {
    .cs-text-style();
    max-width: 32.625rem; // 522px
    margin-bottom: 0;
    color: @text-muted;
    
    body.dark-mode & {
      color: @dark-text-secondary;
    }
    
    @media only screen and (min-width: @tablet) {
      margin-left: 0;
    }
  }

  #cs-form {
    // Apply consistent slice-based layout for all breakpoints
    background-color: transparent;
    border-radius: 0;
    box-shadow: none;
    padding: @spacing-lg @spacing-md;
    margin-bottom: @spacing-md;
    border: none;
    
    // Desktop: Maintain adequate padding but remove card styling
    @media only screen and (min-width: @tablet) {
      padding: @spacing-lg @spacing-lg;
      margin-bottom: @spacing-lg;
    }
    
    // Dark mode: Keep transparent background for all breakpoints
    body.dark-mode & {
      background-color: transparent;
      border: none;
      box-shadow: none;
    }
    
    // Screen reader only content
    .sr-only {
      .sr-only();
    }
    
    .cs-form-group {
      display: flex;
      flex-direction: column;
      gap: @spacing-lg;
      margin-bottom: @spacing-lg;
      
      // Mobile: reduce gaps and spacing for compact layout
      @media only screen and (max-width: @tablet - 1px) {
        gap: @spacing-md;
        margin-bottom: @spacing-md;
      }
      
      // Desktop: Maintain single-column layout for consistency
      @media only screen and (min-width: @tablet) {
        gap: @spacing-lg;
        margin-bottom: @spacing-lg;
      }
    }

    label {
      .form-label();
      font-weight: @font-weight-semibold;
      line-height: @line-height-relaxed;
      margin-bottom: @spacing-lg;
      color: var(--headerColor);
      display: flex;
      flex-direction: column;
      position: relative;
      
      // Mobile: reduce label spacing for compact layout
      @media only screen and (max-width: @tablet - 1px) {
        margin-bottom: @spacing-md;
      }
      
      body.dark-mode & {
        color: @dark-text-primary;
      }
    }

    .cs-required {
      color: @error-color;
      font-weight: @font-weight-bold;
      margin-left: @spacing-xs;
      
      body.dark-mode & {
        color: @form-error-dark;
      }
    }

    .cs-label-message {
      margin-bottom: @spacing-lg;
      
      // Mobile: consistent message label spacing with other fields
      @media only screen and (max-width: @tablet - 1px) {
        margin-bottom: @spacing-md;
      }
    }

    input,
    textarea {
      font-size: @form-input-size;
      font-family: @font-family-base;
      font-weight: @font-weight-normal;
      width: 100%;
      height: 3.5rem; // 56px - slightly more compact
      margin-top: @spacing-sm;
      box-sizing: border-box;
      padding: 0 @spacing-lg;
      border: 2px solid @form-border-light;
      border-radius: @border-radius-lg;
      background-color: @form-card-bg;
      color: var(--bodyTextColor);
      line-height: @line-height-normal;
      .smooth-transition(border-color);
      .smooth-transition(box-shadow);
      .smooth-transition(background-color);
      box-shadow: @shadow-xs;

      // Mobile: optimize for touch and smaller screens
      @media only screen and (max-width: @tablet - 1px) {
        height: 3rem; // 48px - more compact for mobile
        padding: 0 @spacing-md;
        margin-top: @spacing-xs;
        border-radius: @border-radius-md;
        font-size: 1rem; // Ensure 16px to prevent zoom on iOS
      }

      &:hover {
        border-color: @form-border-hover;
        box-shadow: @shadow-sm;
      }

      &:focus {
        border-color: var(--primary);
        outline: none;
        box-shadow: 0 0 0 3px rgba(128, 192, 92, 0.1), @shadow-sm;
        background-color: @form-card-bg;
      }

      &::placeholder {
        color: @form-placeholder;
        opacity: 1;
        font-style: italic;
        font-weight: @font-weight-normal;
        font-size: @font-size-sm;
        
        // Mobile: adjust placeholder size
        @media only screen and (max-width: @tablet - 1px) {
          font-size: @font-size-md;
        }
      }

      // Enhanced validation states with better visual feedback
      &:invalid:not(:placeholder-shown) {
        border-color: @form-error-light;
        box-shadow: 0 0 0 3px @form-error-bg-light;
      }

      &:valid:not(:placeholder-shown) {
        border-color: @form-success-light;
        box-shadow: 0 0 0 3px @form-success-bg-dark;
      }

      body.dark-mode & {
        background-color: var(--medium);
        border-color: @border-color-dark;
        color: var(--bodyTextColorWhite);
        box-shadow: @shadow-dark-sm;

        &:hover {
          border-color: @border-color-dark;
          box-shadow: @shadow-dark-md;
        }

        &:focus {
          border-color: var(--primary);
          background-color: var(--medium);
          box-shadow: 0 0 0 3px rgba(128, 192, 92, 0.2), @shadow-dark-md;
        }

        &::placeholder {
          color: @form-text-muted;
        }

        &:invalid:not(:placeholder-shown) {
          border-color: @form-error-dark;
          box-shadow: 0 0 0 3px @form-error-bg-dark;
        }

        &:valid:not(:placeholder-shown) {
          border-color: @form-success-dark;
          box-shadow: 0 0 0 3px @form-success-bg-dark;
        }
      }
    }

    textarea {
      min-height: 7rem; // 112px - slightly more compact
      padding: @spacing-lg;
      resize: vertical;
      line-height: @line-height-relaxed;
      height: auto;
      font-family: @font-family-base;
      font-weight: @font-weight-normal;
      
      // Mobile: smaller textarea and padding
      @media only screen and (max-width: @tablet - 1px) {
        min-height: 5rem; // 80px - more compact for mobile
        padding: @spacing-md;
      }
      
      &::placeholder {
        line-height: @line-height-relaxed;
      }
    }

    .cs-error {
      display: none;
      font-size: @font-size-sm;
      color: @form-error-border;
      margin-top: @spacing-sm;
      font-weight: @font-weight-medium;
      padding: @spacing-xs @spacing-sm;
      background-color: @form-error-bg-light;
      border-radius: @border-radius-sm;
      border-left: 3px solid @form-error-border;
      
      &.show {
        display: block;
        animation: slideDown 0.3s ease-out;
      }
      
      body.dark-mode & {
        color: @form-error-dark;
        background-color: @form-error-bg-dark;
        border-left-color: @form-error-dark;
      }
    }
    
    .cs-help-text {
      display: block;
      font-family: @font-family-base;
      font-size: @font-size-xs;
      color: @text-muted;
      margin-top: @spacing-xs;
      font-style: italic;
      line-height: @line-height-normal;
      
      body.dark-mode & {
        color: @form-text-muted;
      }
    }

    .cs-button-solid {
      .button-primary();
      width: 100%;
      height: 3.5rem; // 56px
      border: none;
      border-radius: @border-radius-lg;
      position: relative;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: @spacing-sm;
      font-weight: @font-weight-semibold;
      font-size: @font-size-md;
      text-transform: none;
      box-shadow: 0 4px 14px rgba(128, 192, 92, 0.3);
      .smooth-transition(transform);
      .smooth-transition(box-shadow);
      
      // Mobile: optimize button for touch
      @media only screen and (max-width: @tablet - 1px) {
        height: 3rem; // 48px - more compact for mobile
        border-radius: @border-radius-md;
        font-size: @font-size-sm;
        margin-top: @spacing-sm; // Add top margin for mobile
      }
      
      // Fix the pseudo-element from button-primary mixin to maintain border-radius
      &::before {
        border-radius: @border-radius-lg;
        
        // Mobile: match mobile border radius
        @media only screen and (max-width: @tablet - 1px) {
          border-radius: @border-radius-md;
        }
      }
      
      &:hover {
        transform: translateY(-1px);
        box-shadow: 0 6px 20px rgba(128, 192, 92, 0.4);
        border-radius: @border-radius-lg; // Maintain rounded corners on hover
        
        // Mobile: maintain mobile border radius on hover
        @media only screen and (max-width: @tablet - 1px) {
          border-radius: @border-radius-md;
        }
      }
      
      &:active {
        transform: translateY(0);
      }
      
      .cs-loading {
        display: none;
        width: 1.25rem;
        height: 1.25rem;
      }

      &.loading {
        .cs-loading {
          display: block;
        }
        
        span {
          opacity: 0.7;
        }
      }

      &:disabled {
        opacity: 0.6;
        cursor: not-allowed;
        transform: none;
      }
      
      body.dark-mode & {
        box-shadow: 0 4px 14px rgba(128, 192, 92, 0.2);
        
        &:hover {
          box-shadow: 0 6px 20px rgba(128, 192, 92, 0.3);
        }
      }
    }

    .cs-status {
      margin-top: @spacing-lg;
      padding: @spacing-lg;
      border-radius: @border-radius-lg;
      text-align: center;
      font-weight: @font-weight-medium;
      display: none;
      border: 2px solid transparent;
      
      // Mobile: compact status styling
      @media only screen and (max-width: @tablet - 1px) {
        margin-top: @spacing-md;
        padding: @spacing-md;
        border-radius: @border-radius-md;
        font-size: @font-size-sm;
      }
      
      &.success {
        display: block;
        background-color: @form-success-bg-light;
        border-color: @form-success-border-light;
        color: @success-color;
        animation: slideDown 0.3s ease-out;
        
        body.dark-mode & {
          background-color: @form-success-bg-dark;
          border-color: @form-success-border-dark;
          color: @form-success-dark;
        }
      }
      
      &.error {
        display: block;
        background-color: @form-error-status-bg-light;
        border-color: @form-error-status-border-light;
        color: @form-error-status-text-light;
        animation: slideDown 0.3s ease-out;
        
        body.dark-mode & {
          background-color: @form-error-status-bg-dark;
          border-color: @form-error-status-border-dark;
          color: @form-error-status-text-dark;
        }
      }
    }

    // Fieldset styling
    fieldset {
      border: none;
      margin: 0;
      padding: 0;
      margin-bottom: @spacing-lg;
      
      // Mobile: reduce fieldset spacing for compact layout
      @media only screen and (max-width: @tablet - 1px) {
        margin-bottom: @spacing-md;
      }
      
      &:last-of-type {
        margin-bottom: @spacing-lg;
        
        // Mobile: consistent last fieldset spacing
        @media only screen and (max-width: @tablet - 1px) {
          margin-bottom: @spacing-md;
        }
      }
    }
  }
}

// Animation for smooth appearance of error messages and status
@keyframes slideDown {
  from {
    opacity: 0;
    transform: translateY(-10px);
    max-height: 0;
  }
  to {
    opacity: 1;
    transform: translateY(0);
    max-height: 100px;
  }
}

@keyframes fadeInUp {
  from {
    opacity: 0;
    transform: translateY(20px);
  }
  to {
    opacity: 1;
    transform: translateY(0);
  }
}

// Mobile-specific animation optimization
@media only screen and (max-width: @tablet - 1px) {
  .cs-contact-form {
    // Subtle entrance animation for mobile
    animation: fadeInUp 0.6s ease-out;
  }
}
</style> 

<script>
  // Enhanced mobile form validation and UX
  document.addEventListener('DOMContentLoaded', function() {
    const forms = document.querySelectorAll('form[id*="cs-form"]');
    
    forms.forEach(form => {
      const inputs = form.querySelectorAll('input[required], textarea[required]');
      const submitButton = form.querySelector('.cs-button-solid');
      const statusDiv = form.querySelector('.cs-status');
      
      // Enhanced mobile validation with touch support
      inputs.forEach(input => {
        // Real-time validation on blur for better mobile UX
        input.addEventListener('blur', function() {
          validateField(this);
        });
        
        // Clear errors on focus for mobile-friendly experience
        input.addEventListener('focus', function() {
          clearFieldError(this);
        });
        
        // Enhanced input handling for mobile
        input.addEventListener('input', function() {
          // Clear validation state on input for immediate feedback
          if (this.classList.contains('error')) {
            this.classList.remove('error');
            clearFieldError(this);
          }
        });
      });
      
      // Enhanced form submission with mobile-optimized feedback
      form.addEventListener('submit', function(e) {
        e.preventDefault();
        
        let isValid = true;
        
        // Validate all required fields
        inputs.forEach(input => {
          if (!validateField(input)) {
            isValid = false;
          }
        });
        
        if (isValid) {
          submitForm(form);
        } else {
          // Mobile-friendly error handling - scroll to first error
          const firstError = form.querySelector('.error');
          if (firstError) {
            firstError.scrollIntoView({ 
              behavior: 'smooth', 
              block: 'center'
            });
            (firstError as HTMLElement).focus();
          }
        }
      });
    });
    
    function validateField(field) {
      const errorSpan = field.parentNode.querySelector('.cs-error');
      let isValid = true;
      let errorMessage = '';
      
      // Check if field is empty
      if (field.hasAttribute('required') && !field.value.trim()) {
        isValid = false;
        errorMessage = `${getFieldLabel(field)} is required.`;
      }
      // Email validation
      else if (field.type === 'email' && field.value.trim()) {
        const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
        if (!emailRegex.test(field.value.trim())) {
          isValid = false;
          errorMessage = 'Please enter a valid email address.';
        }
      }
      // Phone validation (basic)
      else if (field.type === 'tel' && field.value.trim()) {
        const phoneRegex = /^[\+]?[1-9][\d]{0,15}$/;
        const cleanPhone = field.value.replace(/[\s\-\(\)\.]/g, '');
        if (cleanPhone.length < 10) {
          isValid = false;
          errorMessage = 'Please enter a valid phone number.';
        }
      }
      
      if (!isValid) {
        field.classList.add('error');
        if (errorSpan) {
          errorSpan.textContent = errorMessage;
          errorSpan.classList.add('show');
        }
      } else {
        field.classList.remove('error');
        if (errorSpan) {
          errorSpan.classList.remove('show');
          errorSpan.textContent = '';
        }
      }
      
      return isValid;
    }
    
    function clearFieldError(field) {
      const errorSpan = field.parentNode.querySelector('.cs-error');
      field.classList.remove('error');
      if (errorSpan) {
        errorSpan.classList.remove('show');
        errorSpan.textContent = '';
      }
    }
    
    function getFieldLabel(field) {
      const label = field.parentNode.querySelector('.cs-label-text');
      if (label) {
        return label.textContent.replace('*', '').trim();
      }
      return 'This field';
    }
    
    function submitForm(form) {
      const submitButton = form.querySelector('.cs-button-solid');
      const statusDiv = form.querySelector('.cs-status');
      const buttonText = submitButton.querySelector('span');
      const loading = submitButton.querySelector('.cs-loading');
      
      // Show loading state with mobile-optimized feedback
      submitButton.classList.add('loading');
      submitButton.disabled = true;
      if (loading) loading.style.display = 'block';
      if (buttonText) buttonText.textContent = 'Sending...';
      
      // Hide previous status
      statusDiv.className = 'cs-status';
      statusDiv.textContent = '';
      
      // Simulate form submission (replace with actual submission logic)
      setTimeout(() => {
        // Reset button state
        submitButton.classList.remove('loading');
        submitButton.disabled = false;
        if (loading) loading.style.display = 'none';
        if (buttonText) buttonText.textContent = 'Submit';
        
        // Show success message with mobile-friendly animation
        statusDiv.className = 'cs-status success show';
        statusDiv.textContent = 'Thank you! Your message has been sent successfully. We\'ll get back to you soon.';
        
        // Scroll to status message on mobile
        if (window.innerWidth < 768) {
          statusDiv.scrollIntoView({ 
            behavior: 'smooth', 
            block: 'center'
          });
        }
        
        // Reset form
        form.reset();
        
        // Clear any remaining error states
        form.querySelectorAll('.error').forEach(el => el.classList.remove('error'));
        form.querySelectorAll('.cs-error.show').forEach(el => {
          el.classList.remove('show');
          el.textContent = '';
        });
        
      }, 2000);
    }
  });
</script> 